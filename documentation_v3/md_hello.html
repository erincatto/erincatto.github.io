<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>box2d: Hello Box2D (NOT UPDATED for Box2D version 3.0)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">box2d<span id="projectnumber">&#160;3.0.0</span>
   </div>
   <div id="projectbrief">A 2D physics engine for games</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_hello.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Hello Box2D (NOT UPDATED for Box2D version 3.0)</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md20"></a>In the distribution of Box2D is a Hello World project. The program creates a large ground box and a small dynamic box. This code does not contain any graphics. All you will see is text output in the console of the box's position over time.</p>
<p>This is a good example of how to get up and running with Box2D.</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Creating a World</h1>
<p>Every Box2D program begins with the creation of a b2World object. b2World is the physics hub that manages memory, objects, and simulation. You can allocate the physics world on the stack, heap, or data section.</p>
<p>It is easy to create a Box2D world. First, we define the gravity vector.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="types_8h.html#structb2_vec2">b2Vec2</a> gravity(0.0f, -10.0f);</div>
<div class="ttc" id="atypes_8h_html_structb2_vec2"><div class="ttname"><a href="types_8h.html#structb2_vec2">b2Vec2</a></div><div class="ttdef"><b>Definition</b> types.h:47</div></div>
</div><!-- fragment --><p>Now we create the world object. Note that we are creating the world on the stack, so the world must remain in scope.</p>
<div class="fragment"><div class="line">b2World world(gravity);</div>
</div><!-- fragment --><p>So now we have our physics world, let's start adding some stuff to it.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Creating a Ground Box</h1>
<p>Bodies are built using the following steps:</p><ol type="1">
<li>Define a body with position, damping, etc.</li>
<li>Use the world object to create the body.</li>
<li>Define fixtures with a shape, friction, density, etc.</li>
<li>Create fixtures on the body.</li>
</ol>
<p>For step 1 we create the ground body. For this we need a body definition. With the body definition we specify the initial position of the ground body.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="types_8h.html#structb2_body_def">b2BodyDef</a> groundBodyDef;</div>
<div class="line">groundBodyDef.<a class="code hl_variable" href="types_8h.html#a680cadc09ad6cf4b3366cbf0914c648b">position</a>.Set(0.0f, -10.0f);</div>
<div class="ttc" id="atypes_8h_html_a680cadc09ad6cf4b3366cbf0914c648b"><div class="ttname"><a href="types_8h.html#a680cadc09ad6cf4b3366cbf0914c648b">b2BodyDef::position</a></div><div class="ttdeci">b2Vec2 position</div><div class="ttdef"><b>Definition</b> types.h:208</div></div>
<div class="ttc" id="atypes_8h_html_structb2_body_def"><div class="ttname"><a href="types_8h.html#structb2_body_def">b2BodyDef</a></div><div class="ttdef"><b>Definition</b> types.h:201</div></div>
</div><!-- fragment --><p>For step 2 the body definition is passed to the world object to create the ground body. The world object does not keep a reference to the body definition. Bodies are static by default. Static bodies don't collide with other static bodies and are immovable.</p>
<div class="fragment"><div class="line">b2Body* groundBody = world.CreateBody(&amp;groundBodyDef);</div>
</div><!-- fragment --><p>For step 3 we create a ground polygon. We use the SetAsBox shortcut to form the ground polygon into a box shape, with the box centered on the origin of the parent body.</p>
<div class="fragment"><div class="line">b2PolygonShape groundBox;</div>
<div class="line">groundBox.SetAsBox(50.0f, 10.0f);</div>
</div><!-- fragment --><p>The SetAsBox function takes the <b>half</b>-**width** and <b>half</b>-**height** (extents). So in this case the ground box is 100 units wide (x-axis) and 20 units tall (y-axis). Box2D is tuned for meters, kilograms, and seconds. So you can consider the extents to be in meters. Box2D generally works best when objects are the size of typical real world objects. For example, a barrel is about 1 meter tall. Due to the limitations of floating point arithmetic, using Box2D to model the movement of glaciers or dust particles is not a good idea.</p>
<p>We finish the ground body in step 4 by creating the shape fixture. For this step we have a shortcut. We do not have a need to alter the default fixture material properties, so we can pass the shape directly to the body without creating a fixture definition. Later we will see how to use a fixture definition for customized material properties. The second parameter is the shape density in kilograms per meter squared. A static body has zero mass by definition, so the density is not used in this case.</p>
<div class="fragment"><div class="line">groundBody-&gt;CreateFixture(&amp;groundBox, 0.0f);</div>
</div><!-- fragment --><p>Box2D does not keep a reference to the shape. It clones the data into a new b2Shape object.</p>
<p>Note that every fixture must have a parent body, even fixtures that are static. However, you can attach all static fixtures to a single static body.</p>
<p>When you attach a shape to a body using a fixture, the shape's coordinates become local to the body. So when the body moves, so does the shape. A fixture's world transform is inherited from the parent body. A fixture does not have a transform independent of the body. So we don't move a shape around on the body. Moving or modifying a shape that is on a body is not supported. The reason is simple: a body with morphing shapes is not a rigid body, but Box2D is a rigid body engine. Many of the assumptions made in Box2D are based on the rigid body model. If this is violated many things will break</p>
<h1><a class="anchor" id="autotoc_md23"></a>
Creating a Dynamic Body</h1>
<p>So now we have a ground body. We can use the same technique to create a dynamic body. The main difference, besides dimensions, is that we must establish the dynamic body's mass properties.</p>
<p>First we create the body using CreateBody. By default bodies are static, so we should set the b2BodyType at construction time to make the body dynamic.</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="types_8h.html#structb2_body_def">b2BodyDef</a> bodyDef;</div>
<div class="line">bodyDef.<a class="code hl_variable" href="types_8h.html#a89cc3ad1873908042b002147b3861381">type</a> = b2_dynamicBody;</div>
<div class="line">bodyDef.<a class="code hl_variable" href="types_8h.html#a680cadc09ad6cf4b3366cbf0914c648b">position</a>.Set(0.0f, 4.0f);</div>
<div class="line">b2Body* body = world.CreateBody(&amp;bodyDef);</div>
<div class="ttc" id="atypes_8h_html_a89cc3ad1873908042b002147b3861381"><div class="ttname"><a href="types_8h.html#a89cc3ad1873908042b002147b3861381">b2BodyDef::type</a></div><div class="ttdeci">b2BodyType type</div><div class="ttdef"><b>Definition</b> types.h:204</div></div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<b>Caution</b>: You must set the body type to b2_dynamicBody if you want the body to move in response to forces. </p>
</blockquote>
<p>Next we create and attach a polygon shape using a fixture definition. First we create a box shape:</p>
<div class="fragment"><div class="line">b2PolygonShape dynamicBox;</div>
<div class="line">dynamicBox.SetAsBox(1.0f, 1.0f);</div>
</div><!-- fragment --><p>Next we create a fixture definition using the box. Notice that we set density to 1. The default density is zero. Also, the friction on the shape is set to 0.3.</p>
<div class="fragment"><div class="line">b2FixtureDef fixtureDef;</div>
<div class="line">fixtureDef.shape = &amp;dynamicBox;</div>
<div class="line">fixtureDef.density = 1.0f;</div>
<div class="line">fixtureDef.friction = 0.3f;</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>&zwj;<b>Caution</b>: A dynamic body should have at least one fixture with a non-zero density. Otherwise you will get strange behavior. </p>
</blockquote>
<p>Using the fixture definition we can now create the fixture. This automatically updates the mass of the body. You can add as many fixtures as you like to a body. Each one contributes to the total mass.</p>
<div class="fragment"><div class="line">body-&gt;CreateFixture(&amp;fixtureDef);</div>
</div><!-- fragment --><p>That's it for initialization. We are now ready to begin simulating.</p>
<h1><a class="anchor" id="autotoc_md24"></a>
Simulating the World</h1>
<p>So we have initialized the ground box and a dynamic box. Now we are ready to set Newton loose to do his thing. We just have a couple more issues to consider.</p>
<p>Box2D uses a computational algorithm called an integrator. Integrators simulate the physics equations at discrete points of time. This goes along with the traditional game loop where we essentially have a flip book of movement on the screen. So we need to pick a time step for Box2D. Generally physics engines for games like a time step at least as fast as 60Hz or 1/60 seconds. You can get away with larger time steps, but you will have to be more careful about setting up the definitions for your world. We also don't like the time step to change much. A variable time step produces variable results, which makes it difficult to debug. So don't tie the time step to your frame rate (unless you really, really have to). Without further ado, here is the time step.</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> timeStep = 1.0f / 60.0f;</div>
</div><!-- fragment --><p>In addition to the integrator, Box2D also uses a larger bit of code called a constraint solver. The constraint solver solves all the constraints in the simulation, one at a time. A single constraint can be solved perfectly. However, when we solve one constraint, we slightly disrupt other constraints. To get a good solution, we need to iterate over all constraints a number of times.</p>
<p>There are two phases in the constraint solver: a velocity phase and a position phase. In the velocity phase the solver computes the impulses necessary for the bodies to move correctly. In the position phase the solver adjusts the positions of the bodies to reduce overlap and joint detachment. Each phase has its own iteration count. In addition, the position phase may exit iterations early if the errors are small.</p>
<p>The suggested iteration count for Box2D is 8 for velocity and 3 for position. You can tune this number to your liking, just keep in mind that this has a trade-off between performance and accuracy. Using fewer iterations increases performance but accuracy suffers. Likewise, using more iterations decreases performance but improves the quality of your simulation. For this simple example, we don't need much iteration. Here are our chosen iteration counts.</p>
<div class="fragment"><div class="line">int32 velocityIterations = 6;</div>
<div class="line">int32 positionIterations = 2;</div>
</div><!-- fragment --><p>Note that the time step and the iteration count are completely unrelated. An iteration is not a sub-step. One solver iteration is a single pass over all the constraints within a time step. You can have multiple passes over the constraints within a single time step.</p>
<p>We are now ready to begin the simulation loop. In your game the simulation loop can be merged with your game loop. In each pass through your game loop you call b2World::Step. Just one call is usually enough, depending on your frame rate and your physics time step.</p>
<p>The Hello World program was designed to be simple, so it has no graphical output. The code prints out the position and rotation of the dynamic body. Here is the simulation loop that simulates 60 time steps for a total of 1 second of simulated time.</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span> (int32 i = 0; i &lt; 60; ++i)</div>
<div class="line">{</div>
<div class="line">    world.Step(timeStep, velocityIterations, positionIterations);</div>
<div class="line">    <a class="code hl_struct" href="types_8h.html#structb2_vec2">b2Vec2</a> position = body-&gt;GetPosition();</div>
<div class="line">    <span class="keywordtype">float</span> angle = body-&gt;GetAngle();</div>
<div class="line">    printf(<span class="stringliteral">&quot;%4.2f %4.2f %4.2f\n&quot;</span>, position.<a class="code hl_variable" href="types_8h.html#a7922601d8b8ad0550c2082ebaf74c78a">x</a>, position.y, angle);</div>
<div class="line">}</div>
<div class="ttc" id="atypes_8h_html_a7922601d8b8ad0550c2082ebaf74c78a"><div class="ttname"><a href="types_8h.html#a7922601d8b8ad0550c2082ebaf74c78a">b2Vec2::x</a></div><div class="ttdeci">float x</div><div class="ttdoc">coordinates</div><div class="ttdef"><b>Definition</b> types.h:49</div></div>
</div><!-- fragment --><p>The output shows the box falling and landing on the ground box. Your output should look like this:</p>
<div class="fragment"><div class="line">0.00 4.00 0.00</div>
<div class="line">0.00 3.99 0.00</div>
<div class="line">0.00 3.98 0.00</div>
<div class="line">...</div>
<div class="line">0.00 1.25 0.00</div>
<div class="line">0.00 1.13 0.00</div>
<div class="line">0.00 1.01 0.00</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md25"></a>
Cleanup</h1>
<p>When a world leaves scope or is deleted by calling delete on a pointer, all the memory reserved for bodies, fixtures, and joints is freed. This is done to improve performance and make your life easier. However, you will need to nullify any body, fixture, or joint pointers you have because they will become invalid. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
