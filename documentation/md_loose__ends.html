<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Box2D: Loose Ends</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Box2D<span id="projectnumber">&#160;3.0.0</span>
   </div>
   <div id="projectbrief">A 2D physics engine for games</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_loose__ends.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Loose Ends</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md118"></a> </p>
<h1><a class="anchor" id="autotoc_md119"></a>
User Data</h1>
<p>Bodies, shapes, and joints allow you to attach user data as a <code>void*</code>. This is handy when you are examining Box2D data structures and you want to determine how they relate to the objects in your game engine.</p>
<p>For example, it is typical to attach an entity pointer to the rigid body on that entity. This sets up a circular reference. If you have the entity, you can get the body. If you have the body, you can get the entity.</p>
<div class="fragment"><div class="line">GameEntity* entity = GameCreateEntity();</div>
<div class="line"><a class="code hl_struct" href="group__body.html#structb2_body_def">b2BodyDef</a> bodyDef = <a class="code hl_function" href="group__body.html#ga853e18f389eabf0e8cef10a81407e219">b2DefaultBodyDef</a>();</div>
<div class="line">bodyDef.<a class="code hl_variable" href="group__body.html#ae457dd1d39be09945eace6061121be29">userData</a> = entity;</div>
<div class="line">entity-&gt;bodyId = <a class="code hl_function" href="group__body.html#gae508148d6b854188a14075edd90c7777">b2CreateBody</a>(myWorldId, &amp;bodyDef);</div>
<div class="ttc" id="agroup__body_html_ae457dd1d39be09945eace6061121be29"><div class="ttname"><a href="group__body.html#ae457dd1d39be09945eace6061121be29">b2BodyDef::userData</a></div><div class="ttdeci">void * userData</div><div class="ttdoc">Use this to store application specific body data.</div><div class="ttdef"><b>Definition</b> types.h:184</div></div>
<div class="ttc" id="agroup__body_html_ga853e18f389eabf0e8cef10a81407e219"><div class="ttname"><a href="group__body.html#ga853e18f389eabf0e8cef10a81407e219">b2DefaultBodyDef</a></div><div class="ttdeci">b2BodyDef b2DefaultBodyDef(void)</div><div class="ttdoc">Use this to initialize your body definition.</div></div>
<div class="ttc" id="agroup__body_html_gae508148d6b854188a14075edd90c7777"><div class="ttname"><a href="group__body.html#gae508148d6b854188a14075edd90c7777">b2CreateBody</a></div><div class="ttdeci">b2BodyId b2CreateBody(b2WorldId worldId, const b2BodyDef *def)</div><div class="ttdoc">Create a rigid body given a definition.</div></div>
<div class="ttc" id="agroup__body_html_structb2_body_def"><div class="ttname"><a href="group__body.html#structb2_body_def">b2BodyDef</a></div><div class="ttdoc">A body definition holds all the data needed to construct a rigid body.</div><div class="ttdef"><b>Definition</b> types.h:146</div></div>
</div><!-- fragment --><p>Here are some examples of cases where you would need the user data:</p><ul>
<li>Applying damage to an entity using a collision result.</li>
<li>Playing a scripted event if the player is inside an axis-aligned box.</li>
<li>Accessing a game structure when Box2D notifies you that a joint is going to be destroyed.</li>
</ul>
<p>Keep in mind that user data is optional and you can put anything in it. However, you should be consistent. For example, if you want to store an entity pointer on one body, you should keep an entity pointer on all bodies. Don't store a <code>GameEntity</code> pointer on one body, and a <code>ParticleSystem</code> pointer on another body. Casting a <code>GameEntity</code> to a <code>ParticleSystem</code> pointer may lead to a crash.</p>
<h1><a class="anchor" id="autotoc_md120"></a>
Pixels and Coordinate Systems</h1>
<p>I recommend using MKS (meters, kilograms, and seconds) units and radians for angles. You may have trouble working with meters because your game is expressed in terms of pixels. To deal with this in the sample I have the whole <em>game</em> world in meters and just use an OpenGL viewport transformation to scale the world into screen space.</p>
<p>You use code like this to scale your graphics.</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> lowerX = -25.0f, upperX = 25.0f, lowerY = -5.0f, upperY = 25.0f;</div>
<div class="line">gluOrtho2D(lowerX, upperX, lowerY, upperY);</div>
</div><!-- fragment --><p>If your game must work in pixel units then you could convert your length units from pixels to meters when passing values from Box2D. Likewise you should convert the values received from Box2D from meters to pixels. This will improve the stability of the physics simulation.</p>
<p>You have to come up with a reasonable conversion factor. I suggest making this choice based on the size of your characters. Suppose you have determined to use 50 pixels per meter (because your character is 75 pixels tall). Then you can convert from pixels to meters using these formulas:</p>
<div class="fragment"><div class="line">xMeters = 0.02f * xPixels;</div>
<div class="line">yMeters = 0.02f * yPixels;</div>
</div><!-- fragment --><p>In reverse:</p>
<div class="fragment"><div class="line">xPixels = 50.0f * xMeters;</div>
<div class="line">yPixels = 50.0f * yMeters;</div>
</div><!-- fragment --><p>You should consider using MKS units in your game code and just convert to pixels when you render. This will simplify your game logic and reduce the chance for errors since the rendering conversion can be isolated to a small amount of code.</p>
<p>If you use a conversion factor, you should try tweaking it globally to make sure nothing breaks. You can also try adjusting it to improve stability.</p>
<p>If this conversion is not possible, you can set the length units used by Box2D using <code><a class="el" href="group__math.html#ga654e6f942a5d2abee54b6bba4176b15b" title="Box2D bases all length units on meters, but you may need different units for your game.">b2SetLengthUnitsPerMeter()</a></code>. This is experimental and not well tested.</p>
<h1><a class="anchor" id="autotoc_md121"></a>
Debug Drawing</h1>
<p>You can implement the function pointers in <code><a class="el" href="structb2_debug_draw.html" title="This struct holds callbacks you can implement to draw a Box2D world.">b2DebugDraw</a></code> struct to get detailed drawing of the Box2D world. Debug draw provides:</p><ul>
<li>shapes</li>
<li>joints</li>
<li>broad-phase axis-aligned bounding boxes (AABBs)</li>
<li>center of mass</li>
<li>contact points</li>
</ul>
<p>This is the preferred method of drawing the Box2D simulation, rather than accessing the data directly. The reason is that much of the necessary data is internal and subject to change.</p>
<p>The samples application draws the Box2D world using the <code><a class="el" href="structb2_debug_draw.html" title="This struct holds callbacks you can implement to draw a Box2D world.">b2DebugDraw</a></code>.</p>
<h1><a class="anchor" id="autotoc_md122"></a>
Limitations</h1>
<p>Box2D uses several approximations to simulate rigid body physics efficiently. This brings some limitations.</p>
<p>Here are the current limitations:</p><ol type="1">
<li>Extreme mass ratios may cause joint stretching and collision overlap.</li>
<li>Box2D uses soft constraints to improve robustness. This can lead to joint and contact flexing.</li>
<li>Continuous collision does not handle all situations. For example, general dynamic versus dynamic continuous collision is not handled. <a class="el" href="md_simulation.html#bullets">Bullets</a> handle this in a limited way. This is done for performance reasons.</li>
<li>Continuous collision does not handle joints. So you may see joint stretching on fast moving objects. Usually the joints recover after a few time steps.</li>
<li>Box2D uses the <a href="https://en.wikipedia.org/wiki/Semi-implicit_Euler_method">semi-implicit Euler method</a> to solve the <a href="https://en.wikipedia.org/wiki/Equations_of_motion">equations of motion</a>. It does not reproduce exactly the parabolic motion of projectiles and has only first-order accuracy. However it is fast and has good stability.</li>
<li>Box2D uses a the <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Seidel_method">Gauss-Seidel method</a> to solve constraints and achieve real-time performance. You will not get precisely rigid collisions or pixel perfect accuracy. Increasing the sub-step count will improve accuracy. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
