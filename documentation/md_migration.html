<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Box2D: Migration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">Box2D<span id="projectnumber">&#160;3.1.0</span>
   </div>
   <div id="projectbrief">A 2D physics engine for games</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_migration.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Migration Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md173"></a></p>
<blockquote class="doxtable">
<p><b>Caution</b>: This guide only covers the transition from 2.4 to 3.0. Please see the release notes for future version changes. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md174"></a>
Version 2.4 to Version 3.0</h1>
<p>Box2D version 3.0 is a full rewrite. You can read some background information <a href="https://box2d.org/posts/2023/01/starting-box2d-3.0/">here</a>.</p>
<p>Here are the highlights that affect the API:</p><ul>
<li>moved from C++ to C</li>
<li>identifiers (handles) instead of pointers</li>
<li>multithreading support</li>
<li>fewer callbacks</li>
<li>more features (such as capsules and shape casts)</li>
<li>new sub-stepping solver (<em>Soft Step</em>)</li>
<li>gear and pulley joint removed (temporarily)</li>
</ul>
<p>However, the scope of what Box2D does has not changed much. It is still a 2D rigid body engine. It is just faster and more robust (hopefully). And hopefully it is easier to work with and port/wrap for other languages/platforms.</p>
<p>I'm going to describe migration by comparing code snippets between 2.4 and 3.0. These should give you and idea of the sort of transformations you need to make to your code to migrate to v3.0. These snippets are written in C and may need some small adjustments to work with C++.</p>
<p>I'm not going to cover all the details of v3.0 in this guide. That is the job of the manual, the doxygen reference, and the samples.</p>
<p>The surface area of the Box2D is smaller in v3.0 because C++ is not good at hiding details. So hopefully you find the new API easier to work with.</p>
<h2><a class="anchor" id="autotoc_md175"></a>
Creating a world</h2>
<p>Version 2.4: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;box2d/box2d.h&quot;</span></div>
<div class="line"><a class="code hl_struct" href="group__math.html#structb2_vec2">b2Vec2</a> gravity(0.0f, -10.0f);</div>
<div class="line">b2World world(gravity);</div>
<div class="ttc" id="agroup__math_html_structb2_vec2"><div class="ttname"><a href="group__math.html#structb2_vec2">b2Vec2</a></div><div class="ttdoc">2D vector This can be used to represent a point or free vector</div><div class="ttdef"><b>Definition</b> math_functions.h:21</div></div>
</div><!-- fragment --><p> Version 3.0: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;box2d/box2d.h&quot;</span></div>
<div class="line"><a class="code hl_struct" href="group__math.html#structb2_vec2">b2Vec2</a> gravity = {0.0f, -10.0f};</div>
<div class="line"><a class="code hl_struct" href="group__world.html#structb2_world_def">b2WorldDef</a> worldDef = <a class="code hl_function" href="group__world.html#gaf2777d7b8c7f2f289d5b70b3da9bd75f">b2DefaultWorldDef</a>();</div>
<div class="line">worldDef.<a class="code hl_variable" href="group__world.html#a9152b6fd416622e7f00ba0bac86508dd">gravity</a> = gravity;</div>
<div class="line"><a class="code hl_struct" href="group__id.html#structb2_world_id">b2WorldId</a> worldId = <a class="code hl_function" href="group__world.html#gab9ae1534039f2f835c3b9974abbb5110">b2CreateWorld</a>(&amp;worldDef);</div>
<div class="ttc" id="agroup__id_html_structb2_world_id"><div class="ttname"><a href="group__id.html#structb2_world_id">b2WorldId</a></div><div class="ttdoc">World id references a world instance. This should be treated as an opaque handle.</div><div class="ttdef"><b>Definition</b> id.h:38</div></div>
<div class="ttc" id="agroup__world_html_a9152b6fd416622e7f00ba0bac86508dd"><div class="ttname"><a href="group__world.html#a9152b6fd416622e7f00ba0bac86508dd">b2WorldDef::gravity</a></div><div class="ttdeci">b2Vec2 gravity</div><div class="ttdoc">Gravity vector. Box2D has no up-vector defined.</div><div class="ttdef"><b>Definition</b> types.h:83</div></div>
<div class="ttc" id="agroup__world_html_gab9ae1534039f2f835c3b9974abbb5110"><div class="ttname"><a href="group__world.html#gab9ae1534039f2f835c3b9974abbb5110">b2CreateWorld</a></div><div class="ttdeci">B2_API b2WorldId b2CreateWorld(const b2WorldDef *def)</div><div class="ttdoc">Create a world for rigid body simulation.</div></div>
<div class="ttc" id="agroup__world_html_gaf2777d7b8c7f2f289d5b70b3da9bd75f"><div class="ttname"><a href="group__world.html#gaf2777d7b8c7f2f289d5b70b3da9bd75f">b2DefaultWorldDef</a></div><div class="ttdeci">b2WorldDef b2DefaultWorldDef(void)</div><div class="ttdoc">Use this to initialize your world definition.</div></div>
<div class="ttc" id="agroup__world_html_structb2_world_def"><div class="ttname"><a href="group__world.html#structb2_world_def">b2WorldDef</a></div><div class="ttdoc">World definition used to create a simulation world.</div><div class="ttdef"><b>Definition</b> types.h:81</div></div>
</div><!-- fragment --><p> There is now a required world definition. C does not have constructors, so you need to initialize <b>ALL</b> structures that you pass to Box2D. Box2D provides an initialization helper for almost all structures. For example <code><a class="el" href="group__world.html#gaf2777d7b8c7f2f289d5b70b3da9bd75f" title="Use this to initialize your world definition.">b2DefaultWorldDef()</a></code> is used here to initialize <code><a class="el" href="group__world.html#structb2_world_def" title="World definition used to create a simulation world.">b2WorldDef</a></code>. <code><a class="el" href="group__world.html#structb2_world_def" title="World definition used to create a simulation world.">b2WorldDef</a></code> provides many options, but the defaults are good enough to get going.</p>
<p>In Version 3.0, Box2D objects are generally hidden and you only have an identifier. This keeps the API small. So when you create a world you just get a <code><a class="el" href="group__id.html#structb2_world_id" title="World id references a world instance. This should be treated as an opaque handle.">b2WorldId</a></code> which you should treat as an atomic object, like <code>int</code> or <code>float</code>. It is small and should be passed by value.</p>
<p>In Version 3.0 there are also no destructors, so you must destroy the world. </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__world.html#ga894e7f6f1fca04c2428b69e35f16b46f">b2DestroyWorld</a>(worldId);</div>
<div class="line">worldId = b2_nullWorldId;</div>
<div class="ttc" id="agroup__world_html_ga894e7f6f1fca04c2428b69e35f16b46f"><div class="ttname"><a href="group__world.html#ga894e7f6f1fca04c2428b69e35f16b46f">b2DestroyWorld</a></div><div class="ttdeci">B2_API void b2DestroyWorld(b2WorldId worldId)</div><div class="ttdoc">Destroy a world.</div></div>
</div><!-- fragment --><p> This destroys all bodies, shapes, and joints as well. This is quicker than destroying them individually. Just like pointers, it is good practice to nullify identifiers. Box2D provides null values for all identifiers and also macros such as <code>B2_IS_NULL</code> to test if an identifier is null.</p>
<h2><a class="anchor" id="autotoc_md176"></a>
Creating a body</h2>
<p>Version 2.4: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__body.html#structb2_body_def">b2BodyDef</a> bodyDef;</div>
<div class="line">bodyDef.<a class="code hl_variable" href="group__body.html#a89cc3ad1873908042b002147b3861381">type</a> = <a class="code hl_enumvalue" href="group__body.html#gga74ddb02261648c2bff691a866b5c03e0a65cfde8d03fe7855d91759842840ef40">b2_dynamicBody</a>;</div>
<div class="line">bodyDef.<a class="code hl_variable" href="group__body.html#a680cadc09ad6cf4b3366cbf0914c648b">position</a>.Set(0.0f, 4.0f);</div>
<div class="line">b2Body* body = world.CreateBody(&amp;bodyDef);</div>
<div class="ttc" id="agroup__body_html_a680cadc09ad6cf4b3366cbf0914c648b"><div class="ttname"><a href="group__body.html#a680cadc09ad6cf4b3366cbf0914c648b">b2BodyDef::position</a></div><div class="ttdeci">b2Vec2 position</div><div class="ttdoc">The initial world position of the body.</div><div class="ttdef"><b>Definition</b> types.h:185</div></div>
<div class="ttc" id="agroup__body_html_a89cc3ad1873908042b002147b3861381"><div class="ttname"><a href="group__body.html#a89cc3ad1873908042b002147b3861381">b2BodyDef::type</a></div><div class="ttdeci">b2BodyType type</div><div class="ttdoc">The body type: static, kinematic, or dynamic.</div><div class="ttdef"><b>Definition</b> types.h:180</div></div>
<div class="ttc" id="agroup__body_html_gga74ddb02261648c2bff691a866b5c03e0a65cfde8d03fe7855d91759842840ef40"><div class="ttname"><a href="group__body.html#gga74ddb02261648c2bff691a866b5c03e0a65cfde8d03fe7855d91759842840ef40">b2_dynamicBody</a></div><div class="ttdeci">@ b2_dynamicBody</div><div class="ttdoc">positive mass, velocity determined by forces, moved by solver</div><div class="ttdef"><b>Definition</b> types.h:166</div></div>
<div class="ttc" id="agroup__body_html_structb2_body_def"><div class="ttname"><a href="group__body.html#structb2_body_def">b2BodyDef</a></div><div class="ttdoc">A body definition holds all the data needed to construct a rigid body.</div><div class="ttdef"><b>Definition</b> types.h:178</div></div>
</div><!-- fragment --><p> Version 3.0: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__body.html#structb2_body_def">b2BodyDef</a> bodyDef = <a class="code hl_function" href="group__body.html#ga853e18f389eabf0e8cef10a81407e219">b2DefaultBodyDef</a>();</div>
<div class="line">bodyDef.<a class="code hl_variable" href="group__body.html#a89cc3ad1873908042b002147b3861381">type</a> = <a class="code hl_enumvalue" href="group__body.html#gga74ddb02261648c2bff691a866b5c03e0a65cfde8d03fe7855d91759842840ef40">b2_dynamicBody</a>;</div>
<div class="line">bodyDef.<a class="code hl_variable" href="group__body.html#a680cadc09ad6cf4b3366cbf0914c648b">position</a> = (<a class="code hl_struct" href="group__math.html#structb2_vec2">b2Vec2</a>){0.0f, 4.0f};</div>
<div class="line"><a class="code hl_struct" href="group__id.html#structb2_body_id">b2BodyId</a> bodyId = <a class="code hl_function" href="group__body.html#ga61874d79bebe9baea67dffef53f840e0">b2CreateBody</a>(worldId, &amp;bodyDef);</div>
<div class="ttc" id="agroup__body_html_ga61874d79bebe9baea67dffef53f840e0"><div class="ttname"><a href="group__body.html#ga61874d79bebe9baea67dffef53f840e0">b2CreateBody</a></div><div class="ttdeci">B2_API b2BodyId b2CreateBody(b2WorldId worldId, const b2BodyDef *def)</div><div class="ttdoc">Create a rigid body given a definition.</div></div>
<div class="ttc" id="agroup__body_html_ga853e18f389eabf0e8cef10a81407e219"><div class="ttname"><a href="group__body.html#ga853e18f389eabf0e8cef10a81407e219">b2DefaultBodyDef</a></div><div class="ttdeci">b2BodyDef b2DefaultBodyDef(void)</div><div class="ttdoc">Use this to initialize your body definition.</div></div>
<div class="ttc" id="agroup__id_html_structb2_body_id"><div class="ttname"><a href="group__id.html#structb2_body_id">b2BodyId</a></div><div class="ttdoc">Body id references a body instance. This should be treated as an opaque handle.</div><div class="ttdef"><b>Definition</b> id.h:45</div></div>
</div><!-- fragment --><p> Body creation is very similar in v3.0. In this case there is a definition initialization function <code><a class="el" href="group__body.html#ga853e18f389eabf0e8cef10a81407e219" title="Use this to initialize your body definition.">b2DefaultBodyDef()</a></code>. This can help save a bit of typing in some cases. In v3.0 I recommend getting comfortable with curly brace initialization for initializing vectors. There are no member functions in C. Notice that the body is created using a loose function and providing the <code><a class="el" href="group__id.html#structb2_world_id" title="World id references a world instance. This should be treated as an opaque handle.">b2WorldId</a></code> as an argument. Basically what you would expect going from C++ to C.</p>
<p>Destroying a body is also similar. Version 2.4: </p><div class="fragment"><div class="line">world.DestroyBody(body);</div>
<div class="line">body = <span class="keyword">nullptr</span>;</div>
</div><!-- fragment --><p> Version 3.0: </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__body.html#ga89cb8fceace5f31a1e3ac28e390b18b0">b2DestroyBody</a>(bodyId);</div>
<div class="line">bodyId = b2_nullBodyId;</div>
<div class="ttc" id="agroup__body_html_ga89cb8fceace5f31a1e3ac28e390b18b0"><div class="ttname"><a href="group__body.html#ga89cb8fceace5f31a1e3ac28e390b18b0">b2DestroyBody</a></div><div class="ttdeci">B2_API void b2DestroyBody(b2BodyId bodyId)</div><div class="ttdoc">Destroy a rigid body given an id.</div></div>
</div><!-- fragment --><p> Notice there is a little magic here in Version 3.0. <code><a class="el" href="group__id.html#structb2_body_id" title="Body id references a body instance. This should be treated as an opaque handle.">b2BodyId</a></code> knows what world it comes from. So you do not need to provide <code>worldId</code> when destroying the body. Version 3.0 supports up to 128 worlds. This may be increased or be overridden in the future.</p>
<p>Shapes and joints are still destroyed automatically. However, <code>b2DestructionListener</code> is gone. This holds to the theme of fewer callbacks. However, you can now use <code><a class="el" href="group__shape.html#ga48f3b596f9ae950c7b3c752528808476" title="Shape identifier validation. Provides validation for up to 64K allocations.">b2Shape_IsValid()</a></code> and <code><a class="el" href="group__joint.html#ga4ddbea8f07d8049e84ff3a8dd5789cbc" title="Joint identifier validation. Provides validation for up to 64K allocations.">b2Joint_IsValid()</a></code>.</p>
<h2><a class="anchor" id="autotoc_md177"></a>
Creating a shape</h2>
<p>Shape creation has been streamlined in Version 3.0. <code>b2Fixture</code> is gone. I feel like it was a confusing concept so I hope you don't miss it.</p>
<p>Version 2.4: </p><div class="fragment"><div class="line">b2PolygonShape box;</div>
<div class="line">box.SetAsBox(1.0f, 1.0f);</div>
<div class="line"> </div>
<div class="line">b2FixtureDef fixtureDef;</div>
<div class="line">fixtureDef.shape = &amp;box;</div>
<div class="line">fixtureDef.density = 1.0f;</div>
<div class="line">fixtureDef.friction = 0.3f;</div>
<div class="line"> </div>
<div class="line">b2Fixture* fixture = body-&gt;CreateFixture(&amp;fixtureDef);</div>
</div><!-- fragment --><p>Version 3.0: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__geometry.html#structb2_polygon">b2Polygon</a> box = <a class="code hl_function" href="group__geometry.html#gad5fff23dd63ef099af09c0fb13fb41a3">b2MakeBox</a>(1.0f, 1.0f);</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="group__shape.html#structb2_shape_def">b2ShapeDef</a> shapeDef = <a class="code hl_function" href="group__shape.html#gab4ca752f5de1d27c953f3520bd8fcef1">b2DefaultShapeDef</a>();</div>
<div class="line">shapeDef.<a class="code hl_variable" href="group__shape.html#ab0ddf90317622a46ac9cb54e47342b54">density</a> = 1.0f;</div>
<div class="line">shapeDef.friction = 0.3f;</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="group__id.html#structb2_shape_id">b2ShapeId</a> shapeId = <a class="code hl_function" href="group__shape.html#ga3e55037d832f0cbf30f467eea5c6107e">b2CreatePolygonShape</a>(bodyId, &amp;shapeDef, &amp;box);</div>
<div class="ttc" id="agroup__geometry_html_gad5fff23dd63ef099af09c0fb13fb41a3"><div class="ttname"><a href="group__geometry.html#gad5fff23dd63ef099af09c0fb13fb41a3">b2MakeBox</a></div><div class="ttdeci">b2Polygon b2MakeBox(float halfWidth, float halfHeight)</div><div class="ttdoc">Make a box (rectangle) polygon, bypassing the need for a convex hull.</div></div>
<div class="ttc" id="agroup__geometry_html_structb2_polygon"><div class="ttname"><a href="group__geometry.html#structb2_polygon">b2Polygon</a></div><div class="ttdoc">A solid convex polygon.</div><div class="ttdef"><b>Definition</b> collision.h:134</div></div>
<div class="ttc" id="agroup__id_html_structb2_shape_id"><div class="ttname"><a href="group__id.html#structb2_shape_id">b2ShapeId</a></div><div class="ttdoc">Shape id references a shape instance. This should be treated as an opaque handle.</div><div class="ttdef"><b>Definition</b> id.h:53</div></div>
<div class="ttc" id="agroup__shape_html_ab0ddf90317622a46ac9cb54e47342b54"><div class="ttname"><a href="group__shape.html#ab0ddf90317622a46ac9cb54e47342b54">b2ShapeDef::density</a></div><div class="ttdeci">float density</div><div class="ttdoc">The density, usually in kg/m^2.</div><div class="ttdef"><b>Definition</b> types.h:378</div></div>
<div class="ttc" id="agroup__shape_html_ga3e55037d832f0cbf30f467eea5c6107e"><div class="ttname"><a href="group__shape.html#ga3e55037d832f0cbf30f467eea5c6107e">b2CreatePolygonShape</a></div><div class="ttdeci">B2_API b2ShapeId b2CreatePolygonShape(b2BodyId bodyId, const b2ShapeDef *def, const b2Polygon *polygon)</div><div class="ttdoc">Create a polygon shape and attach it to a body.</div></div>
<div class="ttc" id="agroup__shape_html_gab4ca752f5de1d27c953f3520bd8fcef1"><div class="ttname"><a href="group__shape.html#gab4ca752f5de1d27c953f3520bd8fcef1">b2DefaultShapeDef</a></div><div class="ttdeci">b2ShapeDef b2DefaultShapeDef(void)</div><div class="ttdoc">Use this to initialize your shape definition.</div></div>
<div class="ttc" id="agroup__shape_html_structb2_shape_def"><div class="ttname"><a href="group__shape.html#structb2_shape_def">b2ShapeDef</a></div><div class="ttdoc">Used to create a shape.</div><div class="ttdef"><b>Definition</b> types.h:368</div></div>
</div><!-- fragment --><p>So basically v2.4 shapes are no longer shapes, they are <em>primitives</em> or <em>geometry</em> with no inheritance (of course). This freed the term <em>shape</em> to be used where <em>fixture</em> was used before. In v3.0 the shape definition is generic and there are different functions for creating each shape type, such as <code>b2CreateCircleShape</code> or <code>b2CreateSegmentShape</code>.</p>
<p>Again notice the structure initialization with <code><a class="el" href="group__shape.html#gab4ca752f5de1d27c953f3520bd8fcef1" title="Use this to initialize your shape definition.">b2DefaultShapeDef()</a></code>. Unfortunately we cannot have meaningful definitions with zero initialization. You must initialize your structures.</p>
<p>Another important change for shapes is that the default density in the shape definition is now 1 instead of 0. Static and kinematic bodies will ignore the density. You can now make an entire game without touching the density.</p>
<p>Destroying shapes is straight forward.</p>
<p>Version 2.4: </p><div class="fragment"><div class="line">body-&gt;DestroyFixture(fixture);</div>
<div class="line">fixture = <span class="keyword">nullptr</span>;</div>
</div><!-- fragment --><p>Version 3.0: </p><div class="fragment"><div class="line"><a class="code hl_function" href="group__shape.html#gab34430e8941b244ed8ffcc7d8dc3e249">b2DestroyShape</a>(shapeId);</div>
<div class="line">shapeId = b2_nullShapeId;</div>
<div class="ttc" id="agroup__shape_html_gab34430e8941b244ed8ffcc7d8dc3e249"><div class="ttname"><a href="group__shape.html#gab34430e8941b244ed8ffcc7d8dc3e249">b2DestroyShape</a></div><div class="ttdeci">B2_API void b2DestroyShape(b2ShapeId shapeId, bool updateBodyMass)</div><div class="ttdoc">Destroy a shape.</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md178"></a>
Chains</h2>
<p>In Version 2.4 chains are a type of shape. In Version 3.0 they are a separate concept. This leads to significant simplifications internally. In Version 2.4 all shapes had to support the notion of child shapes. This is gone.</p>
<p>Version 2.4: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__math.html#structb2_vec2">b2Vec2</a> points[5];</div>
<div class="line">points[0].Set(-8.0f, 6.0f);</div>
<div class="line">points[1].Set(-8.0f, 20.0f);</div>
<div class="line">points[2].Set(8.0f, 20.0f);</div>
<div class="line">points[3].Set(8.0f, 6.0f);</div>
<div class="line">points[4].Set(0.0f, -2.0f);</div>
<div class="line"> </div>
<div class="line">b2ChainShape chain;</div>
<div class="line">chain.CreateLoop(points, 5);</div>
<div class="line">b2FixtureDef fixtureDef;</div>
<div class="line">fixtureDef.shape = &amp;chain;</div>
<div class="line">b2Fixture* chainFixture = body-&gt;CreateFixture(&amp;fixtureDef);</div>
</div><!-- fragment --><p>Version 3.0: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__math.html#structb2_vec2">b2Vec2</a> points[5] = {</div>
<div class="line">    {-8.0f, 6.0f},</div>
<div class="line">    {-8.0f, 20.0f},</div>
<div class="line">    {8.0f, 20.0f},</div>
<div class="line">    {8.0f, 6.0f},</div>
<div class="line">    {0.0f, -2.0f}</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="group__shape.html#structb2_chain_def">b2ChainDef</a> chainDef = <a class="code hl_function" href="group__shape.html#ga47bbb3d14c028cc57e1c32da92f51d44">b2DefaultChainDef</a>();</div>
<div class="line">chainDef.<a class="code hl_variable" href="group__shape.html#a828c614397c024606159528381be07f6">points</a> = points;</div>
<div class="line">chainDef.<a class="code hl_variable" href="group__shape.html#a5426ba095d894ee2a918adeeb7c8832a">count</a> = 5;</div>
<div class="line">chainDef.loop = <span class="keyword">true</span>;</div>
<div class="line"><a class="code hl_struct" href="group__id.html#structb2_chain_id">b2ChainId</a> chainId = <a class="code hl_function" href="group__shape.html#ga65c9fc614cba7f5fbd13a7e54c192b7b">b2CreateChain</a>(bodyId, &amp;chainDef);</div>
<div class="ttc" id="agroup__id_html_structb2_chain_id"><div class="ttname"><a href="group__id.html#structb2_chain_id">b2ChainId</a></div><div class="ttdoc">Chain id references a chain instances. This should be treated as an opaque handle.</div><div class="ttdef"><b>Definition</b> id.h:61</div></div>
<div class="ttc" id="agroup__shape_html_a5426ba095d894ee2a918adeeb7c8832a"><div class="ttname"><a href="group__shape.html#a5426ba095d894ee2a918adeeb7c8832a">b2ChainDef::count</a></div><div class="ttdeci">int count</div><div class="ttdoc">The point count, must be 4 or more.</div><div class="ttdef"><b>Definition</b> types.h:443</div></div>
<div class="ttc" id="agroup__shape_html_a828c614397c024606159528381be07f6"><div class="ttname"><a href="group__shape.html#a828c614397c024606159528381be07f6">b2ChainDef::points</a></div><div class="ttdeci">const b2Vec2 * points</div><div class="ttdoc">An array of at least 4 points. These are cloned and may be temporary.</div><div class="ttdef"><b>Definition</b> types.h:440</div></div>
<div class="ttc" id="agroup__shape_html_ga47bbb3d14c028cc57e1c32da92f51d44"><div class="ttname"><a href="group__shape.html#ga47bbb3d14c028cc57e1c32da92f51d44">b2DefaultChainDef</a></div><div class="ttdeci">b2ChainDef b2DefaultChainDef(void)</div><div class="ttdoc">Use this to initialize your chain definition.</div></div>
<div class="ttc" id="agroup__shape_html_ga65c9fc614cba7f5fbd13a7e54c192b7b"><div class="ttname"><a href="group__shape.html#ga65c9fc614cba7f5fbd13a7e54c192b7b">b2CreateChain</a></div><div class="ttdeci">B2_API b2ChainId b2CreateChain(b2BodyId bodyId, const b2ChainDef *def)</div><div class="ttdoc">Chain Shape.</div></div>
<div class="ttc" id="agroup__shape_html_structb2_chain_def"><div class="ttname"><a href="group__shape.html#structb2_chain_def">b2ChainDef</a></div><div class="ttdoc">Used to create a chain of line segments.</div><div class="ttdef"><b>Definition</b> types.h:435</div></div>
</div><!-- fragment --><p>Since chains are their own concept now, they get their own identifier, <code><a class="el" href="group__id.html#structb2_chain_id" title="Chain id references a chain instances. This should be treated as an opaque handle.">b2ChainId</a></code>. You can view chains as macro objects, they create many <code><a class="el" href="group__geometry.html#structb2_chain_segment" title="A line segment with one-sided collision.">b2ChainSegment</a></code> shapes internally. Normally you don't interact with these. However they are returned from queries. You can use <code><a class="el" href="group__shape.html#ga88e589e06875289bf37fa091ba5b566c" title="Get the parent chain id if the shape type is a chain segment, otherwise returns b2_nullChainId.">b2Shape_GetParentChain()</a></code> to get the <code><a class="el" href="group__id.html#structb2_chain_id" title="Chain id references a chain instances. This should be treated as an opaque handle.">b2ChainId</a></code> for a chain segment that you get from a query.</p>
<blockquote class="doxtable">
<p>DO NOT destroy or modify a <code><a class="el" href="group__geometry.html#structb2_chain_segment" title="A line segment with one-sided collision.">b2ChainSegment</a></code> that belongs to a chain shape directly </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md179"></a>
Creating a joint</h2>
<p>Joints are very similar in v3.0. The lack of C member functions changes initialization.</p>
<p>Version 2.4: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__revolute__joint.html#structb2_revolute_joint_def">b2RevoluteJointDef</a> jointDef;</div>
<div class="line">jointDef.Initialize(ground, body, <a class="code hl_struct" href="group__math.html#structb2_vec2">b2Vec2</a>(-10.0f, 20.5f));</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a2ef3e7869ceacdf7212cf813fcc18074">motorSpeed</a> = 1.0f;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#af059ed0a6290622637814d5003739082">maxMotorTorque</a> = 100.0f;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#aa94d9e66be9f03818d0cfbd9c70b2996">enableMotor</a> = <span class="keyword">true</span>;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a27e17792157fff2aedcabb4b98d96f24">lowerAngle</a> = -0.25f * b2_pi;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a59d3a65db0f9ddde1416afa1f9b635a2">upperAngle</a> = 0.5f * b2_pi;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a2eaefc5fc5caf879cfd59ebcd852b756">enableLimit</a> = <span class="keyword">true</span>;:</div>
<div class="line">b2RevolutionJoint* joint = (b2RevoluteJoint*)world-&gt;CreateJoint(&amp;jointDef);</div>
<div class="ttc" id="agroup__revolute__joint_html_a27e17792157fff2aedcabb4b98d96f24"><div class="ttname"><a href="group__revolute__joint.html#a27e17792157fff2aedcabb4b98d96f24">b2RevoluteJointDef::lowerAngle</a></div><div class="ttdeci">float lowerAngle</div><div class="ttdoc">The lower angle for the joint limit in radians. Minimum of -0.95*pi radians.</div><div class="ttdef"><b>Definition</b> types.h:810</div></div>
<div class="ttc" id="agroup__revolute__joint_html_a2eaefc5fc5caf879cfd59ebcd852b756"><div class="ttname"><a href="group__revolute__joint.html#a2eaefc5fc5caf879cfd59ebcd852b756">b2RevoluteJointDef::enableLimit</a></div><div class="ttdeci">bool enableLimit</div><div class="ttdoc">A flag to enable joint limits.</div><div class="ttdef"><b>Definition</b> types.h:807</div></div>
<div class="ttc" id="agroup__revolute__joint_html_a2ef3e7869ceacdf7212cf813fcc18074"><div class="ttname"><a href="group__revolute__joint.html#a2ef3e7869ceacdf7212cf813fcc18074">b2RevoluteJointDef::motorSpeed</a></div><div class="ttdeci">float motorSpeed</div><div class="ttdoc">The desired motor speed in radians per second.</div><div class="ttdef"><b>Definition</b> types.h:822</div></div>
<div class="ttc" id="agroup__revolute__joint_html_a59d3a65db0f9ddde1416afa1f9b635a2"><div class="ttname"><a href="group__revolute__joint.html#a59d3a65db0f9ddde1416afa1f9b635a2">b2RevoluteJointDef::upperAngle</a></div><div class="ttdeci">float upperAngle</div><div class="ttdoc">The upper angle for the joint limit in radians. Maximum of 0.95*pi radians.</div><div class="ttdef"><b>Definition</b> types.h:813</div></div>
<div class="ttc" id="agroup__revolute__joint_html_aa94d9e66be9f03818d0cfbd9c70b2996"><div class="ttname"><a href="group__revolute__joint.html#aa94d9e66be9f03818d0cfbd9c70b2996">b2RevoluteJointDef::enableMotor</a></div><div class="ttdeci">bool enableMotor</div><div class="ttdoc">A flag to enable the joint motor.</div><div class="ttdef"><b>Definition</b> types.h:816</div></div>
<div class="ttc" id="agroup__revolute__joint_html_af059ed0a6290622637814d5003739082"><div class="ttname"><a href="group__revolute__joint.html#af059ed0a6290622637814d5003739082">b2RevoluteJointDef::maxMotorTorque</a></div><div class="ttdeci">float maxMotorTorque</div><div class="ttdoc">The maximum motor torque, typically in newton-meters.</div><div class="ttdef"><b>Definition</b> types.h:819</div></div>
<div class="ttc" id="agroup__revolute__joint_html_structb2_revolute_joint_def"><div class="ttname"><a href="group__revolute__joint.html#structb2_revolute_joint_def">b2RevoluteJointDef</a></div><div class="ttdoc">Revolute joint definition.</div><div class="ttdef"><b>Definition</b> types.h:780</div></div>
</div><!-- fragment --><p> Version 3.0: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__math.html#structb2_vec2">b2Vec2</a> pivot = {-10.0f, 20.5f};</div>
<div class="line"><a class="code hl_struct" href="group__revolute__joint.html#structb2_revolute_joint_def">b2RevoluteJointDef</a> jointDef = <a class="code hl_function" href="group__revolute__joint.html#ga5cf7e7f8824feac112c75c0d44cc6ea3">b2DefaultRevoluteJointDef</a>();</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a87f1685b4c79a39f100cecb8b097b158">bodyIdA</a> = groundId;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#ac2d92f6d6e1c89f4e1fc0f2b0a3cb337">bodyIdB</a> = bodyId;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a76337d07aa63232a7b20d50decc862ae">localAnchorA</a> = <a class="code hl_function" href="group__body.html#gac10f227ccd433b997fe8158d0724f5b9">b2Body_GetLocalPoint</a>(jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a87f1685b4c79a39f100cecb8b097b158">bodyIdA</a>, pivot);</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a3f33bc1d9f6c22043a5ff2f1d89f04e0">localAnchorB</a> = <a class="code hl_function" href="group__body.html#gac10f227ccd433b997fe8158d0724f5b9">b2Body_GetLocalPoint</a>(jointDef.<a class="code hl_variable" href="group__revolute__joint.html#ac2d92f6d6e1c89f4e1fc0f2b0a3cb337">bodyIdB</a>, pivot);</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a2ef3e7869ceacdf7212cf813fcc18074">motorSpeed</a> = 1.0f;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#af059ed0a6290622637814d5003739082">maxMotorTorque</a> = 100.0f;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#aa94d9e66be9f03818d0cfbd9c70b2996">enableMotor</a> = <span class="keyword">true</span>;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a27e17792157fff2aedcabb4b98d96f24">lowerAngle</a> = -0.25f * b2_pi;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a59d3a65db0f9ddde1416afa1f9b635a2">upperAngle</a> = 0.5f * b2_pi;</div>
<div class="line">jointDef.<a class="code hl_variable" href="group__revolute__joint.html#a2eaefc5fc5caf879cfd59ebcd852b756">enableLimit</a> = <span class="keyword">true</span>;</div>
<div class="line"><a class="code hl_struct" href="group__id.html#structb2_joint_id">b2JointId</a> jointId = <a class="code hl_function" href="group__revolute__joint.html#ga9227997192504e87966adab128f4dd2f">b2CreateRevoluteJoint</a>(worldId, &amp;jointDef);</div>
<div class="ttc" id="agroup__body_html_gac10f227ccd433b997fe8158d0724f5b9"><div class="ttname"><a href="group__body.html#gac10f227ccd433b997fe8158d0724f5b9">b2Body_GetLocalPoint</a></div><div class="ttdeci">B2_API b2Vec2 b2Body_GetLocalPoint(b2BodyId bodyId, b2Vec2 worldPoint)</div><div class="ttdoc">Get a local point on a body given a world point.</div></div>
<div class="ttc" id="agroup__id_html_structb2_joint_id"><div class="ttname"><a href="group__id.html#structb2_joint_id">b2JointId</a></div><div class="ttdoc">Joint id references a joint instance. This should be treated as an opaque handle.</div><div class="ttdef"><b>Definition</b> id.h:69</div></div>
<div class="ttc" id="agroup__revolute__joint_html_a3f33bc1d9f6c22043a5ff2f1d89f04e0"><div class="ttname"><a href="group__revolute__joint.html#a3f33bc1d9f6c22043a5ff2f1d89f04e0">b2RevoluteJointDef::localAnchorB</a></div><div class="ttdeci">b2Vec2 localAnchorB</div><div class="ttdoc">The local anchor point relative to bodyB&#39;s origin.</div><div class="ttdef"><b>Definition</b> types.h:791</div></div>
<div class="ttc" id="agroup__revolute__joint_html_a76337d07aa63232a7b20d50decc862ae"><div class="ttname"><a href="group__revolute__joint.html#a76337d07aa63232a7b20d50decc862ae">b2RevoluteJointDef::localAnchorA</a></div><div class="ttdeci">b2Vec2 localAnchorA</div><div class="ttdoc">The local anchor point relative to bodyA&#39;s origin.</div><div class="ttdef"><b>Definition</b> types.h:788</div></div>
<div class="ttc" id="agroup__revolute__joint_html_a87f1685b4c79a39f100cecb8b097b158"><div class="ttname"><a href="group__revolute__joint.html#a87f1685b4c79a39f100cecb8b097b158">b2RevoluteJointDef::bodyIdA</a></div><div class="ttdeci">b2BodyId bodyIdA</div><div class="ttdoc">The first attached body.</div><div class="ttdef"><b>Definition</b> types.h:782</div></div>
<div class="ttc" id="agroup__revolute__joint_html_ac2d92f6d6e1c89f4e1fc0f2b0a3cb337"><div class="ttname"><a href="group__revolute__joint.html#ac2d92f6d6e1c89f4e1fc0f2b0a3cb337">b2RevoluteJointDef::bodyIdB</a></div><div class="ttdeci">b2BodyId bodyIdB</div><div class="ttdoc">The second attached body.</div><div class="ttdef"><b>Definition</b> types.h:785</div></div>
<div class="ttc" id="agroup__revolute__joint_html_ga5cf7e7f8824feac112c75c0d44cc6ea3"><div class="ttname"><a href="group__revolute__joint.html#ga5cf7e7f8824feac112c75c0d44cc6ea3">b2DefaultRevoluteJointDef</a></div><div class="ttdeci">b2RevoluteJointDef b2DefaultRevoluteJointDef(void)</div><div class="ttdoc">Use this to initialize your joint definition.</div></div>
<div class="ttc" id="agroup__revolute__joint_html_ga9227997192504e87966adab128f4dd2f"><div class="ttname"><a href="group__revolute__joint.html#ga9227997192504e87966adab128f4dd2f">b2CreateRevoluteJoint</a></div><div class="ttdeci">B2_API b2JointId b2CreateRevoluteJoint(b2WorldId worldId, const b2RevoluteJointDef *def)</div><div class="ttdoc">Create a revolute joint.</div></div>
</div><!-- fragment --><p>Some of the joints have more options now. Check the code comments and samples for details.</p>
<p>The friction joint has been removed since it is a subset of the motor joint.</p>
<p>The pulley and gear joints have been removed. I'm not satisfied with how they work in 2.4 and plan to implement improved versions in the future.</p>
<h2><a class="anchor" id="autotoc_md180"></a>
New solver</h2>
<p>There is a new solver that uses sub-stepping called <em>Soft Step</em>. Instead of specifying velocity iterations or position iterations, you now specify the number of sub-steps. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="group__world.html#ga8441b35f0a5d67ccf40961a94d4941ef">b2World_Step</a>(<a class="code hl_struct" href="group__id.html#structb2_world_id">b2WorldId</a> worldId, <span class="keywordtype">float</span> timeStep, int32_t subStepCount);</div>
<div class="ttc" id="agroup__world_html_ga8441b35f0a5d67ccf40961a94d4941ef"><div class="ttname"><a href="group__world.html#ga8441b35f0a5d67ccf40961a94d4941ef">b2World_Step</a></div><div class="ttdeci">B2_API void b2World_Step(b2WorldId worldId, float timeStep, int subStepCount)</div><div class="ttdoc">Simulate a world for one time step.</div></div>
</div><!-- fragment --><p> It is recommended to start with 4 sub-steps and adjust as needed. The sub-stepping only computes contact points once per full time step, so contact events are for the full time step.</p>
<p>With a sub-stepping solver you need to think differently about how you interact with bodies. Externally applied impulses or velocity adjustments no longer exist after the first sub-step. So if you try to control the movement of a body by setting the velocity every time step then you may get unexpected results. You will get more predictable results by applying a force and/or torque. Forces and torques are spread across all time steps.</p>
<p>If you want full control over the movement of a body, considering setting the body type to <code>b2_kinematicBody</code>. Preferably this is done in the <code><a class="el" href="group__body.html#structb2_body_def" title="A body definition holds all the data needed to construct a rigid body.">b2BodyDef</a></code>: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__body.html#structb2_body_def">b2BodyDef</a> bodyDef = <a class="code hl_function" href="group__body.html#ga853e18f389eabf0e8cef10a81407e219">b2DefaultBodyDef</a>();</div>
<div class="line">bodyDef.<a class="code hl_variable" href="group__body.html#a89cc3ad1873908042b002147b3861381">type</a> = <a class="code hl_enumvalue" href="group__body.html#gga74ddb02261648c2bff691a866b5c03e0a1b79458529f906fbf58858ab9508b985">b2_kinematicBody</a>;</div>
<div class="ttc" id="agroup__body_html_gga74ddb02261648c2bff691a866b5c03e0a1b79458529f906fbf58858ab9508b985"><div class="ttname"><a href="group__body.html#gga74ddb02261648c2bff691a866b5c03e0a1b79458529f906fbf58858ab9508b985">b2_kinematicBody</a></div><div class="ttdeci">@ b2_kinematicBody</div><div class="ttdoc">zero mass, velocity set by user, moved by solver</div><div class="ttdef"><b>Definition</b> types.h:163</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md181"></a>
Contact data</h2>
<p>In v2.4 <code>b2ContactListener</code> provided <code>BeginContact</code>, <code>EndContact</code>, <code>PreSolve</code>, and <code>PostSolve</code>. You could also iterate over the contacts associated with a body using <code>b2Body::GetContactList</code>. The latter was rarely used due to how continuous collision worked in v2.4 meant that you could miss some contacts using <code>GetContactList</code>.</p>
<p>In v3.0 there is a strong emphasis on multithreading. Callbacks in multithreading are problematic for a few reasons:</p><ul>
<li>chance of race conditions in user code</li>
<li>user code becomes non-deterministic</li>
<li>uncertain performance impact</li>
</ul>
<p>Therefore all callbacks except <code>PreSolve</code> have been removed. Instead you can now access all events and contact data after the time step. Version 3.0 no longer uses collision sub-stepping for continuous collision. This means all contacts data are valid at the end of the time step. Just keep in mind that Box2D computes contact points at the beginning of the time step, so the contact points apply to the previous position of the body.</p>
<p>Here is how you access contact data in v3.0: </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__events.html#structb2_contact_events">b2ContactEvents</a> contactEvents = <a class="code hl_function" href="group__world.html#ga96712bb6c08d335ffa37f7d30404a0e7">b2World_GetContactEvents</a>(worldId);</div>
<div class="ttc" id="agroup__events_html_structb2_contact_events"><div class="ttname"><a href="group__events.html#structb2_contact_events">b2ContactEvents</a></div><div class="ttdoc">Contact events are buffered in the Box2D world and are available as event arrays after the time step ...</div><div class="ttdef"><b>Definition</b> types.h:1100</div></div>
<div class="ttc" id="agroup__world_html_ga96712bb6c08d335ffa37f7d30404a0e7"><div class="ttname"><a href="group__world.html#ga96712bb6c08d335ffa37f7d30404a0e7">b2World_GetContactEvents</a></div><div class="ttdeci">B2_API b2ContactEvents b2World_GetContactEvents(b2WorldId worldId)</div><div class="ttdoc">Get contact events for this current time step. The event data is transient. Do not store a reference ...</div></div>
</div><!-- fragment --><p> The contact events structure has begin and end events: </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code hl_struct" href="group__events.html#structb2_contact_events">b2ContactEvents</a></div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="group__events.html#structb2_contact_begin_touch_event">b2ContactBeginTouchEvent</a>* <a class="code hl_variable" href="group__events.html#a2f6185fb63ea5b7e3a5b231f0db288b5">beginEvents</a>;</div>
<div class="line">    <a class="code hl_struct" href="group__events.html#structb2_contact_end_touch_event">b2ContactEndTouchEvent</a>* <a class="code hl_variable" href="group__events.html#adc2ccea79b76d3252fea19366798202f">endEvents</a>;</div>
<div class="line">  <a class="code hl_struct" href="group__events.html#structb2_contact_hit_event">b2ContactHitEvent</a>* <a class="code hl_variable" href="group__events.html#a95c01c5482e19410e57af65d977606cf">hitEvents</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="group__events.html#add0fa396297688cbeb59531e91a26e44">beginCount</a>;</div>
<div class="line">    <span class="keywordtype">int</span> <a class="code hl_variable" href="group__events.html#ade55bef6bed3e2b23b1be1fcd6887f9b">endCount</a>;</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_variable" href="group__events.html#a1faa3caeb5851df278c028d759e25a7b">hitCount</a>;</div>
<div class="line">} <a class="code hl_struct" href="group__events.html#structb2_contact_events">b2ContactEvents</a>;</div>
<div class="ttc" id="agroup__events_html_a1faa3caeb5851df278c028d759e25a7b"><div class="ttname"><a href="group__events.html#a1faa3caeb5851df278c028d759e25a7b">b2ContactEvents::hitCount</a></div><div class="ttdeci">int hitCount</div><div class="ttdoc">Number of hit events.</div><div class="ttdef"><b>Definition</b> types.h:1117</div></div>
<div class="ttc" id="agroup__events_html_a2f6185fb63ea5b7e3a5b231f0db288b5"><div class="ttname"><a href="group__events.html#a2f6185fb63ea5b7e3a5b231f0db288b5">b2ContactEvents::beginEvents</a></div><div class="ttdeci">b2ContactBeginTouchEvent * beginEvents</div><div class="ttdoc">Array of begin touch events.</div><div class="ttdef"><b>Definition</b> types.h:1102</div></div>
<div class="ttc" id="agroup__events_html_a95c01c5482e19410e57af65d977606cf"><div class="ttname"><a href="group__events.html#a95c01c5482e19410e57af65d977606cf">b2ContactEvents::hitEvents</a></div><div class="ttdeci">b2ContactHitEvent * hitEvents</div><div class="ttdoc">Array of hit events.</div><div class="ttdef"><b>Definition</b> types.h:1108</div></div>
<div class="ttc" id="agroup__events_html_adc2ccea79b76d3252fea19366798202f"><div class="ttname"><a href="group__events.html#adc2ccea79b76d3252fea19366798202f">b2ContactEvents::endEvents</a></div><div class="ttdeci">b2ContactEndTouchEvent * endEvents</div><div class="ttdoc">Array of end touch events.</div><div class="ttdef"><b>Definition</b> types.h:1105</div></div>
<div class="ttc" id="agroup__events_html_add0fa396297688cbeb59531e91a26e44"><div class="ttname"><a href="group__events.html#add0fa396297688cbeb59531e91a26e44">b2ContactEvents::beginCount</a></div><div class="ttdeci">int beginCount</div><div class="ttdoc">Number of begin touch events.</div><div class="ttdef"><b>Definition</b> types.h:1111</div></div>
<div class="ttc" id="agroup__events_html_ade55bef6bed3e2b23b1be1fcd6887f9b"><div class="ttname"><a href="group__events.html#ade55bef6bed3e2b23b1be1fcd6887f9b">b2ContactEvents::endCount</a></div><div class="ttdeci">int endCount</div><div class="ttdoc">Number of end touch events.</div><div class="ttdef"><b>Definition</b> types.h:1114</div></div>
<div class="ttc" id="agroup__events_html_structb2_contact_begin_touch_event"><div class="ttname"><a href="group__events.html#structb2_contact_begin_touch_event">b2ContactBeginTouchEvent</a></div><div class="ttdoc">A begin touch event is generated when two shapes begin touching.</div><div class="ttdef"><b>Definition</b> types.h:1048</div></div>
<div class="ttc" id="agroup__events_html_structb2_contact_end_touch_event"><div class="ttname"><a href="group__events.html#structb2_contact_end_touch_event">b2ContactEndTouchEvent</a></div><div class="ttdoc">An end touch event is generated when two shapes stop touching.</div><div class="ttdef"><b>Definition</b> types.h:1065</div></div>
<div class="ttc" id="agroup__events_html_structb2_contact_hit_event"><div class="ttname"><a href="group__events.html#structb2_contact_hit_event">b2ContactHitEvent</a></div><div class="ttdoc">A hit touch event is generated when two shapes collide with a speed faster than the hit speed thresho...</div><div class="ttdef"><b>Definition</b> types.h:1079</div></div>
</div><!-- fragment --><p> You can loop through these events after the time step. These events are in deterministic order, even with multithreading. See the <code>sample_events.cpp</code> file for examples.</p>
<p>You may not want Box2D to save all contact events, so you can disable them for a given shape using <code>enableContactEvents</code> on <code><a class="el" href="group__shape.html#structb2_shape_def" title="Used to create a shape.">b2ShapeDef</a></code>.</p>
<p>If you want to access persistent contacts, you can get the data from bodies or shapes. </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__events.html#structb2_contact_data">b2ContactData</a> contactData[10];</div>
<div class="line"><span class="keywordtype">int</span> count = <a class="code hl_function" href="group__body.html#gacdb98572a15267a3a159026c2b80ef79">b2Body_GetContactData</a>(bodyId, contactData, 10);</div>
<div class="ttc" id="agroup__body_html_gacdb98572a15267a3a159026c2b80ef79"><div class="ttname"><a href="group__body.html#gacdb98572a15267a3a159026c2b80ef79">b2Body_GetContactData</a></div><div class="ttdeci">B2_API int b2Body_GetContactData(b2BodyId bodyId, b2ContactData *contactData, int capacity)</div><div class="ttdoc">Get the touching contact data for a body.</div></div>
<div class="ttc" id="agroup__events_html_structb2_contact_data"><div class="ttname"><a href="group__events.html#structb2_contact_data">b2ContactData</a></div><div class="ttdoc">The contact data for two shapes.</div><div class="ttdef"><b>Definition</b> types.h:1154</div></div>
</div><!-- fragment --> <div class="fragment"><div class="line"><a class="code hl_struct" href="group__events.html#structb2_contact_data">b2ContactData</a> contactData[10];</div>
<div class="line"><span class="keywordtype">int</span> count = <a class="code hl_function" href="group__shape.html#ga2ab82764df083ea61c24282174b9f012">b2Shape_GetContactData</a>(shapeId, contactData, 10);</div>
<div class="ttc" id="agroup__shape_html_ga2ab82764df083ea61c24282174b9f012"><div class="ttname"><a href="group__shape.html#ga2ab82764df083ea61c24282174b9f012">b2Shape_GetContactData</a></div><div class="ttdeci">B2_API int b2Shape_GetContactData(b2ShapeId shapeId, b2ContactData *contactData, int capacity)</div><div class="ttdoc">Get the touching contact data for a shape.</div></div>
</div><!-- fragment --><p> This includes contact data for contacts reported in begin events. This data is also in deterministic order.</p>
<p>Pre-solve contact modification is available using a callback. </p><div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keywordtype">bool</span> <a class="code hl_typedef" href="group__world.html#gabc67e8e35069f7fc50755006ae5b4bab">b2PreSolveFcn</a>(<a class="code hl_struct" href="group__id.html#structb2_shape_id">b2ShapeId</a> shapeIdA, <a class="code hl_struct" href="group__id.html#structb2_shape_id">b2ShapeId</a> shapeIdB, <a class="code hl_struct" href="group__collision.html#structb2_manifold">b2Manifold</a>* manifold, <span class="keywordtype">void</span>* context);</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="group__world.html#gae6aa7772a42d6389c05947dae00d7d01">b2World_SetPreSolveCallback</a>(<a class="code hl_struct" href="group__id.html#structb2_world_id">b2WorldId</a> worldId, <a class="code hl_typedef" href="group__world.html#gabc67e8e35069f7fc50755006ae5b4bab">b2PreSolveFcn</a>* fcn, <span class="keywordtype">void</span>* context);</div>
<div class="ttc" id="agroup__collision_html_structb2_manifold"><div class="ttname"><a href="group__collision.html#structb2_manifold">b2Manifold</a></div><div class="ttdoc">A contact manifold describes the contact points between colliding shapes.</div><div class="ttdef"><b>Definition</b> collision.h:539</div></div>
<div class="ttc" id="agroup__world_html_gabc67e8e35069f7fc50755006ae5b4bab"><div class="ttname"><a href="group__world.html#gabc67e8e35069f7fc50755006ae5b4bab">b2PreSolveFcn</a></div><div class="ttdeci">bool b2PreSolveFcn(b2ShapeId shapeIdA, b2ShapeId shapeIdB, b2Manifold *manifold, void *context)</div><div class="ttdoc">Prototype for a pre-solve callback.</div><div class="ttdef"><b>Definition</b> types.h:1189</div></div>
<div class="ttc" id="agroup__world_html_gae6aa7772a42d6389c05947dae00d7d01"><div class="ttname"><a href="group__world.html#gae6aa7772a42d6389c05947dae00d7d01">b2World_SetPreSolveCallback</a></div><div class="ttdeci">B2_API void b2World_SetPreSolveCallback(b2WorldId worldId, b2PreSolveFcn *fcn, void *context)</div><div class="ttdoc">Register the pre-solve callback. This is optional.</div></div>
</div><!-- fragment --><p> You can define a pre-solve callback and register that with the world. You can also provide a context variable that will be passed back to your callback. This is <b>not</b> enough to get a pre-solve callback. You also need to enable it on your shape using <code>enablePreSolveEvents</code> in <code><a class="el" href="group__shape.html#structb2_shape_def" title="Used to create a shape.">b2ShapeDef</a></code>. This is false by default.</p>
<blockquote class="doxtable">
<p>Pre-solve callbacks are dangerous. You must avoid race conditions and you must understand that behavior may not be deterministic. This is especially true if you have multiple pre-solve callbacks that are sensitive to order. </p>
</blockquote>
<h2><a class="anchor" id="autotoc_md182"></a>
Sensors</h2>
<p>In v2.4 sensor events were mixed in with contact events. I have split them up to make user code simpler. </p><div class="fragment"><div class="line"><a class="code hl_struct" href="group__events.html#structb2_sensor_events">b2SensorEvents</a> sensorEvents = <a class="code hl_function" href="group__world.html#ga68fddcb791a44f230d63be2d1412e930">b2World_GetSensorEvents</a>(<a class="code hl_struct" href="group__id.html#structb2_world_id">b2WorldId</a> worldId);</div>
<div class="ttc" id="agroup__events_html_structb2_sensor_events"><div class="ttname"><a href="group__events.html#structb2_sensor_events">b2SensorEvents</a></div><div class="ttdoc">Sensor events are buffered in the Box2D world and are available as begin/end overlap event arrays aft...</div><div class="ttdef"><b>Definition</b> types.h:1032</div></div>
<div class="ttc" id="agroup__world_html_ga68fddcb791a44f230d63be2d1412e930"><div class="ttname"><a href="group__world.html#ga68fddcb791a44f230d63be2d1412e930">b2World_GetSensorEvents</a></div><div class="ttdeci">B2_API b2SensorEvents b2World_GetSensorEvents(b2WorldId worldId)</div><div class="ttdoc">Get sensor events for the current time step. The event data is transient. Do not store a reference to...</div></div>
</div><!-- fragment --><p> Note that contact data on bodies and shapes have no information about sensors. That data only has touching contacts.</p>
<p>Sensor events are available to all shapes on dynamic bodies except chains. You can disable them using <code>enableSensorEvents</code> on <code><a class="el" href="group__shape.html#structb2_shape_def" title="Used to create a shape.">b2ShapeDef</a></code>.</p>
<h2><a class="anchor" id="autotoc_md183"></a>
Queries</h2>
<p>Version 2.4 has <code>b2World::QueryAABB</code> and <code>b2World::RayCast</code>. This functionality is largely the same in v3.0, but more features have been added such as precise overlap tests and shape casts.</p>
<p>Another new feature is <code><a class="el" href="group__shape.html#structb2_query_filter" title="The query filter is used to filter collisions between queries and shapes.">b2QueryFilter</a></code> which allows you to filter raycast results before they reach your callback. This query filter is tested against <code><a class="el" href="group__shape.html#structb2_filter" title="This is used to filter collision on shapes.">b2Filter</a></code> on shapes that the query encounters.</p>
<p>Ray casts now take an origin and translation rather than start and end points. This convention works better with the added shape cast functions.</p>
<h2><a class="anchor" id="autotoc_md184"></a>
World iteration</h2>
<p>Iterating over all bodies/shapes/joints/contacts in a world is very inefficient and has been removed from Version 3.0. Instead, you should be using <code><a class="el" href="group__events.html#structb2_body_events" title="Body events are buffered in the Box2D world and are available as event arrays after the time step is ...">b2BodyEvents</a></code> and <code><a class="el" href="group__events.html#structb2_contact_events" title="Contact events are buffered in the Box2D world and are available as event arrays after the time step ...">b2ContactEvents</a></code>. Events are efficient and data-oriented.</p>
<h2><a class="anchor" id="autotoc_md185"></a>
Library configuration</h2>
<p>Version 3.0 offers more library configuration. You can override the allocator and you can intercept assertions by registering global callbacks. These are for expert users and they must be thread safe. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="group__base.html#ga61cd3cba135821c54537871ab731ca92">b2SetAllocator</a>(<a class="code hl_typedef" href="group__base.html#ga403361f17b97a6db73f97ff333f2ee3f">b2AllocFcn</a>* allocFcn, <a class="code hl_typedef" href="group__base.html#ga7981516d12b40604a18ee6459938da8f">b2FreeFcn</a>* freeFcn);</div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="group__base.html#gaa1a866c5d7a43cab3353cd762dc22f1b">b2SetAssertFcn</a>(<a class="code hl_typedef" href="group__base.html#gaae40299ae9aea572fc32c7a5d47ec71d">b2AssertFcn</a>* assertFcn);</div>
<div class="ttc" id="agroup__base_html_ga403361f17b97a6db73f97ff333f2ee3f"><div class="ttname"><a href="group__base.html#ga403361f17b97a6db73f97ff333f2ee3f">b2AllocFcn</a></div><div class="ttdeci">void * b2AllocFcn(unsigned int size, int alignment)</div><div class="ttdoc">Prototype for user allocation function.</div><div class="ttdef"><b>Definition</b> base.h:49</div></div>
<div class="ttc" id="agroup__base_html_ga61cd3cba135821c54537871ab731ca92"><div class="ttname"><a href="group__base.html#ga61cd3cba135821c54537871ab731ca92">b2SetAllocator</a></div><div class="ttdeci">void b2SetAllocator(b2AllocFcn *allocFcn, b2FreeFcn *freeFcn)</div><div class="ttdoc">This allows the user to override the allocation functions.</div></div>
<div class="ttc" id="agroup__base_html_ga7981516d12b40604a18ee6459938da8f"><div class="ttname"><a href="group__base.html#ga7981516d12b40604a18ee6459938da8f">b2FreeFcn</a></div><div class="ttdeci">void b2FreeFcn(void *mem)</div><div class="ttdoc">Prototype for user free function.</div><div class="ttdef"><b>Definition</b> base.h:53</div></div>
<div class="ttc" id="agroup__base_html_gaa1a866c5d7a43cab3353cd762dc22f1b"><div class="ttname"><a href="group__base.html#gaa1a866c5d7a43cab3353cd762dc22f1b">b2SetAssertFcn</a></div><div class="ttdeci">void b2SetAssertFcn(b2AssertFcn *assertFcn)</div><div class="ttdoc">Override the default assert callback.</div></div>
<div class="ttc" id="agroup__base_html_gaae40299ae9aea572fc32c7a5d47ec71d"><div class="ttname"><a href="group__base.html#gaae40299ae9aea572fc32c7a5d47ec71d">b2AssertFcn</a></div><div class="ttdeci">int b2AssertFcn(const char *condition, const char *fileName, int lineNumber)</div><div class="ttdoc">Prototype for the user assert callback. Return 0 to skip the debugger break.</div><div class="ttdef"><b>Definition</b> base.h:56</div></div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
