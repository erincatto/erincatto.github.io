<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Box2D: Loose Ends</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Box2D
   &#160;<span id="projectnumber">2.4.1</span>
   </div>
   <div id="projectbrief">A 2D physics engine for games</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__d_1__git_hub_box2d_docs_loose_ends.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Loose Ends </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md121"></a>
User Data</h1>
<p>The <code><a class="el" href="classb2_fixture.html">b2Fixture</a></code>, <code><a class="el" href="classb2_body.html" title="A rigid body. These are created via b2World::CreateBody.">b2Body</a></code>, and <code><a class="el" href="classb2_joint.html">b2Joint</a></code> classes allow you to attach user data as a uintptr_t. This is handy when you are examining Box2D data structures and you want to determine how they relate to the objects in your game engine.</p>
<p>For example, it is typical to attach an actor pointer to the rigid body on that actor. This sets up a circular reference. If you have the actor, you can get the body. If you have the body, you can get the actor.</p>
<div class="fragment"><div class="line">GameActor* actor = GameCreateActor();</div>
<div class="line"><a class="code" href="structb2_body_def.html">b2BodyDef</a> bodyDef;</div>
<div class="line">bodyDef.<a class="code" href="structb2_body_def.html#ae913ce354e5602ddafecd5999c2db170">userData</a>.<a class="code" href="structb2_body_user_data.html#ae23e3ff9873138240adc85619ba38fb6">pointer</a> = <span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(actor);</div>
<div class="line">actor-&gt;body = myWorld-&gt;<a class="code" href="classb2_world.html#a9323d553e4c132b26d8741b457d7c034">CreateBody</a>(&amp;bodyDef);</div>
</div><!-- fragment --><p>You can also use this to hold an integral value rather than a pointer.</p>
<p>Here are some examples of cases where you would need the user data:</p><ul>
<li>Applying damage to an actor using a collision result.</li>
<li>Playing a scripted event if the player is inside an axis-aligned box.</li>
<li>Accessing a game structure when Box2D notifies you that a joint is going to be destroyed.</li>
</ul>
<p>Keep in mind that user data is optional and you can put anything in it. However, you should be consistent. For example, if you want to store an actor pointer on one body, you should keep an actor pointer on all bodies. Don't store an actor pointer on one body, and a foo pointer on another body. Casting an actor pointer to a foo pointer may lead to a crash.</p>
<p>User data pointers are 0 by default.</p>
<p>For fixtures you might consider defining a user data structure that lets you store game specific information, such as material type, effects hooks, sound hooks, etc.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>FixtureUserData</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> materialIndex;</div>
<div class="line">    <span class="comment">// ...</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">FixtureUserData myData = <span class="keyword">new</span> FixtureUserData;</div>
<div class="line">myData-&gt;materialIndex = 2;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="structb2_fixture_def.html">b2FixtureDef</a> fixtureDef;</div>
<div class="line">fixtureDef.<a class="code" href="structb2_fixture_def.html#a1e41753d89abf3443e7897e2498a3240">shape</a> = &amp;someShape;</div>
<div class="line">fixtureDef.<a class="code" href="structb2_fixture_def.html#a480da3de55f826e8df9e7d2c0f7e911f">userData</a>.<a class="code" href="structb2_fixture_user_data.html#a7de93df0f0e8a734795b04b7255f55a8">pointer</a> = <span class="keyword">reinterpret_cast&lt;</span>uintptr_t<span class="keyword">&gt;</span>(myData);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classb2_fixture.html">b2Fixture</a>* fixture = body-&gt;<a class="code" href="classb2_body.html#a40dda91b34418bb40e31e2db9b1b76a5">CreateFixture</a>(&amp;fixtureDef);</div>
<div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">delete</span> fixture-&gt;<a class="code" href="classb2_fixture.html#af42d4b917097c6300012f63410a985dc">GetUserData</a>();</div>
<div class="line">body-&gt;<a class="code" href="classb2_body.html#a856d1df86b7bded91f02d8cfcaea1c2f">DestroyFixture</a>(fixture);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md122"></a>
Custom User Data</h1>
<p>You can define custom data structures that are embedded in the Box2D data structures. This is done by defining <code>B2_USER_SETTINGS</code> and providing the file <code>b2_user_settings.h</code>. See <code><a class="el" href="b2__settings_8h.html">b2_settings.h</a></code> for details.</p>
<h1><a class="anchor" id="autotoc_md123"></a>
Implicit Destruction</h1>
<p>Box2D doesn't use reference counting. So if you destroy a body it is really gone. Accessing a pointer to a destroyed body has undefined behavior. In other words, your program will likely crash and burn. To help fix these problems, the debug build memory manager fills destroyed entities with FDFDFDFD. This can help find problems more easily in some cases.</p>
<p>If you destroy a Box2D entity, it is up to you to make sure you remove all references to the destroyed object. This is easy if you only have a single reference to the entity. If you have multiple references, you might consider implementing a handle class to wrap the raw pointer.</p>
<p>Often when using Box2D you will create and destroy many bodies, shapes, and joints. Managing these entities is somewhat automated by Box2D. If you destroy a body then all associated shapes and joints are automatically destroyed. This is called implicit destruction.</p>
<p>When you destroy a body, all its attached shapes, joints, and contacts are destroyed. This is called implicit destruction. Any body connected to one of those joints and/or contacts is woken. This process is usually convenient. However, you must be aware of one crucial issue:</p>
<blockquote class="doxtable">
<p><b>Caution</b>: When a body is destroyed, all fixtures and joints attached to the body are automatically destroyed. You must nullify any pointers you have to those shapes and joints. Otherwise, your program will die horribly if you try to access or destroy those shapes or joints later. </p>
</blockquote>
<p>To help you nullify your joint pointers, Box2D provides a listener class named <a class="el" href="classb2_destruction_listener.html">b2DestructionListener</a> that you can implement and provide to your world object. Then the world object will notify you when a joint is going to be implicitly destroyed</p>
<p>Note that there no notification when a joint or fixture is explicitly destroyed. In this case ownership is clear and you can perform the necessary cleanup on the spot. If you like, you can call your own implementation of <a class="el" href="classb2_destruction_listener.html">b2DestructionListener</a> to keep cleanup code centralized.</p>
<p>Implicit destruction is a great convenience in many cases. It can also make your program fall apart. You may store pointers to shapes and joints somewhere in your code. These pointers become orphaned when an associated body is destroyed. The situation becomes worse when you consider that joints are often created by a part of the code unrelated to management of the associated body. For example, the testbed creates a <a class="el" href="classb2_mouse_joint.html">b2MouseJoint</a> for interactive manipulation of bodies on the screen.</p>
<p>Box2D provides a callback mechanism to inform your application when implicit destruction occurs. This gives your application a chance to nullify the orphaned pointers. This callback mechanism is described later in this manual.</p>
<p>You can implement a <code><a class="el" href="classb2_destruction_listener.html">b2DestructionListener</a></code> that allows <a class="el" href="classb2_world.html">b2World</a> to inform you when a shape or joint is implicitly destroyed because an associated body was destroyed. This will help prevent your code from accessing orphaned pointers.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyDestructionListener : <span class="keyword">public</span> <a class="code" href="classb2_destruction_listener.html">b2DestructionListener</a></div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span> <a class="code" href="classb2_destruction_listener.html#a6cd15baa6e5c33118cf7173ab5bf6d58">SayGoodbye</a>(<a class="code" href="classb2_joint.html">b2Joint</a>* joint)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// remove all references to joint.</span></div>
<div class="line">    }</div>
<div class="line">};</div>
</div><!-- fragment --><p>You can then register an instance of your destruction listener with your world object. You should do this during world initialization.</p>
<div class="fragment"><div class="line">myWorld-&gt;SetListener(myDestructionListener);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md124"></a>
Pixels and Coordinate Systems</h1>
<p>Recall that Box2D uses MKS (meters, kilograms, and seconds) units and radians for angles. You may have trouble working with meters because your game is expressed in terms of pixels. To deal with this in the testbed I have the whole <em>game</em> work in meters and just use an OpenGL viewport transformation to scale the world into screen space.</p>
<div class="fragment"><div class="line"><span class="keywordtype">float</span> lowerX = -25.0f, upperX = 25.0f, lowerY = -5.0f, upperY = 25.0f;</div>
<div class="line">gluOrtho2D(lowerX, upperX, lowerY, upperY);</div>
</div><!-- fragment --><p>If your game must work in pixel units then you should convert your length units from pixels to meters when passing values from Box2D. Likewise you should convert the values received from Box2D from meters to pixels. This will improve the stability of the physics simulation.</p>
<p>You have to come up with a reasonable conversion factor. I suggest making this choice based on the size of your characters. Suppose you have determined to use 50 pixels per meter (because your character is 75 pixels tall). Then you can convert from pixels to meters using these formulas:</p>
<div class="fragment"><div class="line">xMeters = 0.02f * xPixels;</div>
<div class="line">yMeters = 0.02f * yPixels;</div>
</div><!-- fragment --><p>In reverse:</p>
<div class="fragment"><div class="line">xPixels = 50.0f * xMeters;</div>
<div class="line">yPixels = 50.0f * yMeters;</div>
</div><!-- fragment --><p>You should consider using MKS units in your game code and just convert to pixels when you render. This will simplify your game logic and reduce the chance for errors since the rendering conversion can be isolated to a small amount of code.</p>
<p>If you use a conversion factor, you should try tweaking it globally to make sure nothing breaks. You can also try adjusting it to improve stability.</p>
<h1><a class="anchor" id="autotoc_md125"></a>
Debug Drawing</h1>
<p>You can implement the b2DebugDraw class to get detailed drawing of the physics world. Here are the available entities:</p><ul>
<li>shape outlines</li>
<li>joint connectivity</li>
<li>broad-phase axis-aligned bounding boxes (AABBs)</li>
<li>center of mass</li>
</ul>
<div class="image">
<img src="debug_draw.png" alt=""/>
<div class="caption">
Debug Draw</div></div>
   <p>This is the preferred method of drawing these physics entities, rather than accessing the data directly. The reason is that much of the necessary data is internal and subject to change.</p>
<p>The testbed draws physics entities using the debug draw facility and the contact listener, so it serves as the primary example of how to implement debug drawing as well as how to draw contact points.</p>
<h1><a class="anchor" id="autotoc_md126"></a>
Limitations</h1>
<p>Box2D uses several approximations to simulate rigid body physics efficiently. This brings some limitations.</p>
<p>Here are the current limitations:</p><ol type="1">
<li>Stacking heavy bodies on top of much lighter bodies is not stable. Stability degrades as the mass ratio passes 10:1.</li>
<li>Chains of bodies connected by joints may stretch if a lighter body is supporting a heavier body. For example, a wrecking ball connect to a chain of light weight bodies may not be stable. Stability degrades as the mass ratio passes 10:1.</li>
<li>There is typically around 0.5cm of slop in shape versus shape collision.</li>
<li>Continuous collision does not handle joints. So you may see joint stretching on fast moving objects.</li>
<li>Box2D uses the symplectic Euler integration scheme. It does not reproduce parabolic motion of projectiles and has only first-order accuracy. However it is fast and has good stability.</li>
<li>Box2D uses an iterative solver to provide real-time performance. You will not get precisely rigid collisions or pixel perfect accuracy. Increasing the iterations will improve accuracy. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="astructb2_body_user_data_html_ae23e3ff9873138240adc85619ba38fb6"><div class="ttname"><a href="structb2_body_user_data.html#ae23e3ff9873138240adc85619ba38fb6">b2BodyUserData::pointer</a></div><div class="ttdeci">uintptr_t pointer</div><div class="ttdoc">For legacy compatibility.</div><div class="ttdef"><b>Definition:</b> b2_settings.h:66</div></div>
<div class="ttc" id="aclassb2_world_html_a9323d553e4c132b26d8741b457d7c034"><div class="ttname"><a href="classb2_world.html#a9323d553e4c132b26d8741b457d7c034">b2World::CreateBody</a></div><div class="ttdeci">b2Body * CreateBody(const b2BodyDef *def)</div></div>
<div class="ttc" id="astructb2_fixture_def_html_a1e41753d89abf3443e7897e2498a3240"><div class="ttname"><a href="structb2_fixture_def.html#a1e41753d89abf3443e7897e2498a3240">b2FixtureDef::shape</a></div><div class="ttdeci">const b2Shape * shape</div><div class="ttdef"><b>Definition:</b> b2_fixture.h:76</div></div>
<div class="ttc" id="aclassb2_destruction_listener_html_a6cd15baa6e5c33118cf7173ab5bf6d58"><div class="ttname"><a href="classb2_destruction_listener.html#a6cd15baa6e5c33118cf7173ab5bf6d58">b2DestructionListener::SayGoodbye</a></div><div class="ttdeci">virtual void SayGoodbye(b2Joint *joint)=0</div></div>
<div class="ttc" id="aclassb2_body_html_a40dda91b34418bb40e31e2db9b1b76a5"><div class="ttname"><a href="classb2_body.html#a40dda91b34418bb40e31e2db9b1b76a5">b2Body::CreateFixture</a></div><div class="ttdeci">b2Fixture * CreateFixture(const b2FixtureDef *def)</div></div>
<div class="ttc" id="astructb2_fixture_def_html"><div class="ttname"><a href="structb2_fixture_def.html">b2FixtureDef</a></div><div class="ttdef"><b>Definition:</b> b2_fixture.h:61</div></div>
<div class="ttc" id="aclassb2_fixture_html"><div class="ttname"><a href="classb2_fixture.html">b2Fixture</a></div><div class="ttdef"><b>Definition:</b> b2_fixture.h:116</div></div>
<div class="ttc" id="astructb2_fixture_user_data_html_a7de93df0f0e8a734795b04b7255f55a8"><div class="ttname"><a href="structb2_fixture_user_data.html#a7de93df0f0e8a734795b04b7255f55a8">b2FixtureUserData::pointer</a></div><div class="ttdeci">uintptr_t pointer</div><div class="ttdoc">For legacy compatibility.</div><div class="ttdef"><b>Definition:</b> b2_settings.h:78</div></div>
<div class="ttc" id="astructb2_body_def_html_ae913ce354e5602ddafecd5999c2db170"><div class="ttname"><a href="structb2_body_def.html#ae913ce354e5602ddafecd5999c2db170">b2BodyDef::userData</a></div><div class="ttdeci">b2BodyUserData userData</div><div class="ttdoc">Use this to store application specific body data.</div><div class="ttdef"><b>Definition:</b> b2_body.h:121</div></div>
<div class="ttc" id="astructb2_body_def_html"><div class="ttname"><a href="structb2_body_def.html">b2BodyDef</a></div><div class="ttdef"><b>Definition:</b> b2_body.h:52</div></div>
<div class="ttc" id="aclassb2_body_html_a856d1df86b7bded91f02d8cfcaea1c2f"><div class="ttname"><a href="classb2_body.html#a856d1df86b7bded91f02d8cfcaea1c2f">b2Body::DestroyFixture</a></div><div class="ttdeci">void DestroyFixture(b2Fixture *fixture)</div></div>
<div class="ttc" id="astructb2_fixture_def_html_a480da3de55f826e8df9e7d2c0f7e911f"><div class="ttname"><a href="structb2_fixture_def.html#a480da3de55f826e8df9e7d2c0f7e911f">b2FixtureDef::userData</a></div><div class="ttdeci">b2FixtureUserData userData</div><div class="ttdoc">Use this to store application specific fixture data.</div><div class="ttdef"><b>Definition:</b> b2_fixture.h:79</div></div>
<div class="ttc" id="aclassb2_joint_html"><div class="ttname"><a href="classb2_joint.html">b2Joint</a></div><div class="ttdef"><b>Definition:</b> b2_joint.h:110</div></div>
<div class="ttc" id="aclassb2_destruction_listener_html"><div class="ttname"><a href="classb2_destruction_listener.html">b2DestructionListener</a></div><div class="ttdef"><b>Definition:</b> b2_world_callbacks.h:41</div></div>
<div class="ttc" id="aclassb2_fixture_html_af42d4b917097c6300012f63410a985dc"><div class="ttname"><a href="classb2_fixture.html#af42d4b917097c6300012f63410a985dc">b2Fixture::GetUserData</a></div><div class="ttdeci">b2FixtureUserData &amp; GetUserData()</div><div class="ttdef"><b>Definition:</b> b2_fixture.h:278</div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
